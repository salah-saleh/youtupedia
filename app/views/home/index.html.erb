<div class="p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Quick Summary Section -->
    <section class="mb-8">
      <h2 class="text-xl font-bold mb-4">Quick Summary</h2>
      <div class="bg-white rounded-lg shadow p-4">
        <%= form_with url: parse_youtube_url_path, method: :post, class: "flex gap-2" do |f| %>
          <%= f.text_field :url,
              placeholder: "Enter YouTube video link here...",
              class: "flex-1 px-4 py-2 rounded-full border focus:outline-none focus:ring-2 focus:ring-purple-500" %>
          <%= f.submit "Summarize",
              class: "bg-purple-600 text-white px-6 py-2 rounded-full hover:bg-purple-700" %>
        <% end %>
      </div>
    </section>

    <!-- Recent Summaries Section -->
    <section>
      <h2 class="text-xl font-bold mb-4">Recent Summaries</h2>
      <% if user_signed_in? %>
        <% video_ids = UserServices::UserDataService.user_items(Current.user.id, :summaries) %>
        <% summaries = video_ids.map do |video_id|
          cache_service = Cache::FileCacheService.new(Chat::ChatGptService.cache_namespace)
          if cache_service.exist?(video_id)
            result = cache_service.read(video_id)
            if result[:success]
              metadata = Youtube::YoutubeMetadataService.fetch_metadata(video_id)
              if metadata[:success]
                {
                  video_id: video_id,
                  title: metadata[:metadata][:title],
                  channel: metadata[:metadata][:channel_title],
                  date: metadata[:metadata][:published_at].present? ? Time.parse(metadata[:metadata][:published_at]) : nil,
                  thumbnail: metadata[:metadata][:thumbnails][:high],
                  tldr: result[:tldr]
                }
              end
            end
          end
        end.compact %>

        <% if summaries.any? %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <% summaries.each do |summary| %>
              <%= link_to summary_path(summary[:video_id]), class: "block" do %>
                <div class="bg-white rounded-lg shadow overflow-hidden hover:shadow-md transition-shadow">
                  <% if summary[:thumbnail] %>
                    <img src="<%= summary[:thumbnail] %>" alt="<%= summary[:title] %>" class="w-full h-48 object-cover">
                  <% end %>
                  <div class="p-4">
                    <h3 class="font-medium text-gray-900 mb-1 line-clamp-2"><%= summary[:title] %></h3>
                    <p class="text-sm text-gray-500"><%= summary[:channel] %></p>
                    <% if summary[:date].present? %>
                      <p class="text-xs text-gray-400 mt-1">Published <%= time_ago_in_words(summary[:date]) %> ago</p>
                    <% end %>
                    <p class="text-sm text-gray-600 mt-2 line-clamp-3"><%= summary[:tldr] %></p>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <div class="bg-white rounded-lg shadow p-8 text-center">
            <p class="text-gray-600">No summaries yet. Try summarizing a YouTube video above!</p>
          </div>
        <% end %>
      <% else %>
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-gray-600 mb-4">Sign in to see your summaries!</p>
          <div class="space-x-4">
            <%= link_to "Sign In", new_session_path, class: "text-purple-600 hover:text-purple-800 font-medium" %>
            <span class="text-gray-400">or</span>
            <%= link_to "Sign Up", new_registration_path, class: "text-purple-600 hover:text-purple-800 font-medium" %>
          </div>
        </div>
      <% end %>
    </section>
  </div>
</div>