<div class="space-y-6">
  <!-- Search Section -->
  <div class="bg-white rounded-lg shadow p-4 lg:p-6">
    <h2 class="text-xl lg:text-lg font-semibold mb-4">Search Content</h2>

    <div class="relative">
      <%= form_with url: search_index_path, method: :get, data: { turbo_frame: "search_results", turbo_action: "advance" }, class: "flex" do |f| %>
        <%= f.text_field :q,
            value: @query,
            placeholder: "Search your recent summaries...",
            class: "flex-1 px-4 py-3.5 text-base rounded-full border border-purple-300 focus:outline-none focus:border-purple-500" %>

        <%= f.submit "Search",
            class: "absolute right-2 top-1/2 transform -translate-y-1/2 px-6 py-2.5 text-base bg-purple-500 text-white rounded-full hover:bg-purple-600" %>
      <% end %>
    </div>
  </div>

  <!-- Results Section -->
  <%= turbo_frame_tag "search_results", class: "block" do %>
    <% if @query.present? %>
      <div class="space-y-6">
        <% if @results.any? %>
          <%# Results count header %>
          <div class="text-sm text-gray-600 mb-4">
            Found <%= @results.length %> results for "<%= @query %>"
          </div>

          <%# Results grid with consistent spacing %>
          <div class="space-y-6">
            <% @results.each do |result| %>
              <%# Individual result card %>
              <div class="bg-white shadow rounded-lg">
                <div class="p-6">
                  <%# Title and score header %>
                  <div class="flex justify-between items-start">
                    <h2 class="text-xl font-semibold text-gray-900">
                      <%= result["title"] %>
                    </h2>
                    <span class="text-sm text-gray-500">
                      Score: <%= result["score"].round(2) %>
                    </span>
                  </div>

                  <%# Metadata line %>
                  <div class="mt-2 text-sm text-gray-600">
                    <%= result["channel_title"] %> â€¢
                    <%= time_ago_in_words(result["published_at"]) %> ago
                  </div>

                  <%# Matched context section with collapsible content %>
                  <% if result["matched_context"].present? %>
                    <div class="mt-4">
                      <div class="bg-gray-50 rounded-md overflow-hidden relative"
                           data-controller="collapsible"
                           data-collapsible-max-height-value="200">
                        <%# Content area %>
                        <div class="p-4">
                          <div class="prose prose-sm max-w-none text-gray-800"
                               data-collapsible-target="content">
                            <%# Convert timestamps and highlight them %>
                            <%= result["matched_context"].gsub(/\((\d+(?:\.\d+)?)\)/) do |match|
                              timestamp = $1.to_f
                              minutes = (timestamp / 60).floor
                              seconds = (timestamp % 60).round
                              "<span class='text-purple-600'>(#{minutes}m:#{seconds}s)</span>"
                            end.html_safe %>
                          </div>
                        </div>

                        <%# Gradient overlay for text fade effect %>
                        <div class="absolute bottom-0 inset-x-0 h-20 bg-gradient-to-t from-gray-50 pointer-events-none"
                             data-collapsible-target="gradient"></div>

                        <%# Show more/less button - z-10 ensures it's above the gradient %>
                        <div class="absolute bottom-0 inset-x-0 bg-gray-50 border-t text-center z-10"
                             data-collapsible-target="footer"
                             data-action="click->collapsible#toggle">
                          <button type="button" class="px-4 py-2 text-sm text-purple-600 hover:text-purple-900">
                            <span data-collapsible-target="buttonText">Show more</span>
                            <svg class="ml-2 h-4 w-4 inline transform transition-transform duration-200"
                                 data-collapsible-target="icon"
                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  <% end %>

                  <%# Action buttons %>
                  <div class="mt-4">
                    <%= link_to summary_path(result["video_id"]), data: { turbo_frame: "_top" }, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-purple-700 bg-purple-100 hover:bg-purple-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                      </svg>
                      View Summary
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <%# No results found state %>
          <div class="bg-white shadow rounded-lg">
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">No results found</h3>
              <p class="mt-1 text-sm text-gray-500">Try adjusting your search terms or adding more videos.</p>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>